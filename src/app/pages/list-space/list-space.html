<div class="min-h-screen bg-white">
  <app-header></app-header>

  <main class="ls-container">
    <div class="ls-header">
      <h1 class="ls-title">{{ editingHousingId() ? 'Edit your space' : 'List your space' }}</h1>
      <p class="ls-subtitle">{{ editingHousingId() ? 'Update your listing information' : 'Create a new listing in a few guided steps' }}</p>
      @if (loadingHousing()) {
        <p class="text-orange-500">Loading property data...</p>
      }
    </div>

    <!-- Stepper -->
    <div class="ls-stepper">
      <div class="ls-step" [class.active]="step() >= 1">1. Basic</div>
      <div class="ls-line"></div>
      <div class="ls-step" [class.active]="step() >= 2">2. Location</div>
      <div class="ls-line"></div>
      <div class="ls-step" [class.active]="step() >= 3">3. Pricing</div>
      <div class="ls-line"></div>
      <div class="ls-step" [class.active]="step() >= 4">4. Amenities</div>
      <div class="ls-line"></div>
      <div class="ls-step" [class.active]="step() >= 5">5. Review</div>
    </div>

    <div class="ls-grid">
      <section class="ls-card" *ngIf="step() === 1">
        <h2 class="ls-card-title">Basic information</h2>
        <div class="ls-form">
          <label class="ls-label">
            <span>Title</span>
            <input class="ls-input" type="text" placeholder="Cozy apartment in Medellín" [ngModel]="title()" (ngModelChange)="title.set($event)" />
          </label>
          <label class="ls-label">
            <span>Description (optional)</span>
            <textarea class="ls-input" rows="3" placeholder="Describe your property, its unique features, and what makes it special..." [ngModel]="description()" (ngModelChange)="description.set($event)"></textarea>
          </label>
          <label class="ls-label">
            <span>Type</span>
            <select class="ls-input" [ngModel]="type()" (ngModelChange)="type.set($event)">
              <option>Apartment</option>
              <option>House</option>
              <option>Villa</option>
              <option>Cabin</option>
              <option>Loft</option>
            </select>
          </label>
          <div class="ls-row">
            <label class="ls-label">
              <span>Guests</span>
              <input class="ls-input" type="number" min="1" [ngModel]="guests()" (ngModelChange)="guests.set($event)" />
            </label>
            <label class="ls-label">
              <span>Bedrooms</span>
              <input class="ls-input" type="number" min="0" [ngModel]="bedrooms()" (ngModelChange)="bedrooms.set($event)" />
            </label>
            <label class="ls-label">
              <span>Bathrooms</span>
              <input class="ls-input" type="number" min="0" [ngModel]="bathrooms()" (ngModelChange)="bathrooms.set($event)" />
            </label>
          </div>
          <div class="ls-error" *ngIf="!validBasic()">Please enter a title (6+ chars) and at least 1 guest.</div>
        </div>
        <div class="ls-actions">
          <app-button (click)="next()" class="btn-orange">Continue</app-button>
        </div>
      </section>

      <section class="ls-card" *ngIf="step() === 2">
        <h2 class="ls-card-title">Location</h2>
        <div class="ls-form">
          <label class="ls-label">
            <span>Country</span>
            <input class="ls-input" type="text" [ngModel]="country()" (ngModelChange)="country.set($event)" />
          </label>
          <label class="ls-label">
            <span>City</span>
            <input class="ls-input" type="text" placeholder="Medellín" [ngModel]="city()" (ngModelChange)="city.set($event)" />
          </label>
          <label class="ls-label">
            <span>Address</span>
            <input class="ls-input" type="text" placeholder="Cra 1 # 2-34" [ngModel]="address()" (ngModelChange)="address.set($event)" />
          </label>
          <div class="ls-error" *ngIf="!validLocation()">Please provide city and address.</div>
        </div>
        <div class="ls-actions">
          <app-button variant="outline" (click)="back()">Back</app-button>
          <app-button (click)="next()" class="btn-orange">Continue</app-button>
        </div>
      </section>

      <section class="ls-card" *ngIf="step() === 3">
        <h2 class="ls-card-title">Pricing</h2>
        <div class="ls-form">
          <label class="ls-label">
            <span>Price per night (USD)</span>
            <input class="ls-input" type="number" min="1" [ngModel]="price()" (ngModelChange)="price.set($event)" />
          </label>
          <div class="ls-error" *ngIf="!validPricing()">Please set a valid price.</div>
        </div>
        <div class="ls-actions">
          <app-button variant="outline" (click)="back()">Back</app-button>
          <app-button (click)="next()" class="btn-orange">Continue</app-button>
        </div>
      </section>

      <section class="ls-card" *ngIf="step() === 4">
        <h2 class="ls-card-title">Amenities</h2>
        <div class="ls-amenities">
          <label class="ls-amenity" *ngFor="let a of amenityOptions">
            <input type="checkbox" [checked]="amenities().includes(a)" (change)="toggleAmenity(a)" />
            <span>{{ a }}</span>
          </label>
        </div>
        
        <h2 class="ls-card-title" style="margin-top: 2rem;">Images (Optional)</h2>
        <p style="color: #6b7280; margin-bottom: 1rem;">Upload up to 10 images (optional)</p>
        
        <div class="ls-image-upload">
          <input 
            type="file" 
            id="imageInput" 
            accept="image/*" 
            multiple 
            (change)="onImageSelected($event)"
            style="display: none;"
            [disabled]="uploadingImages() || images().length >= 10">
          <label for="imageInput" class="ls-upload-btn" [class.disabled]="uploadingImages() || images().length >= 10">
            <lucide-icon name="upload" style="width: 20px; height: 20px; margin-right: 8px;"></lucide-icon>
            {{ uploadingImages() ? 'Uploading...' : 'Upload Images' }}
          </label>
          <span class="ls-image-count">{{ images().length }}/10 images</span>
        </div>

        @if (images().length > 0) {
          <div class="ls-image-grid">
            @for (image of images(); track $index) {
              <div class="ls-image-item">
                <img [src]="image" alt="Property image">
                <button class="ls-image-remove" (click)="removeImage($index)" type="button">
                  <lucide-icon name="x" style="width: 16px; height: 16px;"></lucide-icon>
                </button>
              </div>
            }
          </div>
        }

        @if (!validImages()) {
          <div class="ls-error" style="margin-top: 1rem;">
            You can upload a maximum of 10 images
          </div>
        }

        <div class="ls-actions">
          <app-button variant="outline" (click)="back()">Back</app-button>
          <app-button (click)="next()" class="btn-orange">Continue</app-button>
        </div>
      </section>

      <section class="ls-card" *ngIf="step() === 5">
        <h2 class="ls-card-title">Review & publish</h2>
        <div class="ls-review">
          <div class="review-row"><span>Title</span><strong>{{ title() }}</strong></div>
          <div class="review-row" *ngIf="description()"><span>Description</span><strong>{{ description() }}</strong></div>
          <div class="review-row"><span>Type</span><strong>{{ type() }}</strong></div>
          <div class="review-row"><span>Guests</span><strong>{{ guests() }}</strong></div>
          <div class="review-row"><span>Bedrooms</span><strong>{{ bedrooms() }}</strong></div>
          <div class="review-row"><span>Bathrooms</span><strong>{{ bathrooms() }}</strong></div>
          <div class="review-row"><span>Location</span><strong>{{ address() }}, {{ city() }}, {{ country() }}</strong></div>
          <div class="review-row"><span>Price</span><strong>${{ price() }}/night</strong></div>
          <div class="review-row"><span>Amenities</span><strong>{{ amenities().join(', ') || '—' }}</strong></div>
          <div class="review-row">
            <span>Images</span>
            <strong>
              {{ images().length }} image(s) {{ images().length === 0 ? '(optional)' : '' }}
            </strong>
          </div>
        </div>

        <div class="ls-error" *ngIf="errorMessage()">{{ errorMessage() }}</div>

        <div class="ls-actions">
          <app-button variant="outline" (click)="back()">Back</app-button>
          <app-button (click)="submit()" [disabled]="submitting()" class="btn-orange">
            <span *ngIf="submitting()" class="animate-spin" style="display: inline-block; width: 16px; height: 16px; margin-right: 8px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%;"></span>
            {{ submitting() ? 'Publishing…' : 'Publish listing' }}
          </app-button>
        </div>

        <div class="ls-success" *ngIf="submitted()">
          <lucide-icon name="check-circle-2"></lucide-icon>
          <div>
            <h3>Listing created!</h3>
            <p>Your property has been successfully published and is now visible to guests.</p>
            <app-button (click)="goHome()" class="btn-orange">Back to Home</app-button>
          </div>
        </div>
      </section>
    </div>
  </main>

  <app-footer></app-footer>
</div>
